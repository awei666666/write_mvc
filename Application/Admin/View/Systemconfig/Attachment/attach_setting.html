<extend name="./Application/Admin/View/Layout.html"/>
<block name="head">
	<style>
		.content-padding { padding: 20px; }
		.panel {
			border: none;
		}
		.top-list {
			background-color: #d9edf7;
			padding: 10px;
		}
		.two-list {
			background-color: #dff0d8;
			padding: 5px;
			padding-left: 30px;
		}
		.three-list {
			padding: 0 5px 4px 51px;
			/*padding-left: 51px;*/
		}
		.checkbox {
			margin: 5px 25px 10px 5px;
			/*margin-right: 25px;*/
			/*margin-top: 5px;*/
		}
		.clear {
			clear: both;
		}
		.tab-content .help-block {
			color: #666;
			font-size: 12px;
		}
		.form-group-title {
			background-color: #e8e8e8;
			padding: 3px 8px;
			margin-bottom: 20px;
			background-image: linear-gradient(to bottom, #f5f5f5 0%, #e8e8e8 100%);
			background-repeat: repeat-x;
			border: 1px #ddd solid;
			border-radius: 3px;
			font-size: 12px;
		}
		.panel-body { border: 1px solid #ddd; border-top: none; }
		#sizebox { display: none }

		@keyframes evenflow_shake {
			0% { transform: scale(1); }

			100% { transform: scale(3);  }
		}


		#water:hover{
			animation-name: evenflow_shake;
			animation-duration:500ms;

			}
	</style>
</block>
<block name="content">
	<div class="content-padding">
		<div class="panel-heading-tab">
			<ul class="nav nav-tabs" role="tablist">
				<li class="active">
					<a href="#base" aria-controls="base" role="tab" data-toggle="tab" aria-expanded="true">基本设置</a></li>
				<li class="">
					<a href="#watermark" aria-controls="watermark" role="tab" data-toggle="tab" aria-expanded="false">水印设置</a>
				</li>
				<li class="">
					<a href="#senior" aria-controls="senior" role="tab" data-toggle="tab" aria-expanded="false">高级设置</a>
				</li>
			</ul>
		</div>
		<div class="panel panel-default panel-tab">



			<div class="panel-body">
				<form action="" method="post" class="form-horizontal"  enctype="multipart/form-data">
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane fade in active" id="base">
							<div class="form-group-title">基本设置</div>
							<div class="form-group">
								<label class="col-sm-2 control-label must">附件存放目录</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[save_path]" value="<{$field.save_path}>"/>
								</div>
								<div class="col-sm-6"><span class="help-block">从根目录算起，如：<code>/data/file/</code>结尾需要添加反斜杠</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">目录存放格式</label>

								<div class="col-sm-4">
									<select class="form-control" name="data[format]">
										<option value="">不设置目录</option>
										<optgroup label="日期格式">
											<option value="Ymd"
											<eq name="field.format" value="Ymd">selected="selected"</eq>
											>年月日</option>
											<option value="Y/md"
											<eq name="field.format" value="Y/md">selected="selected"</eq>
											>年/月日</option>
											<option value="Y/m/d"
											<eq name="field.format" value="Y/m/d">selected="selected"</eq>
											>年/月/日</option>
											<option value="Y/m/d/H"
											<eq name="field.format" value="Y/m/d/H">selected="selected"</eq>
											>年/月/日/时</option>
											<option value="Y/mdH"
											<eq name="field.format" value="Y/mdH">selected="selected"</eq>
											>年/月日时</option>
											<option value="YmdH"
											<eq name="field.format" value="YmdH">selected="selected"</eq>
											>年月日时</option>
										</optgroup>
									</select>
								</div>
								<div class="col-sm-6"><span class="help-block">设置目录存放格式，从附件目录算起</span></div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">后台允许上传类型</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[admin_type]" value="<{$field.admin_type}>"/>
								</div>
								<div class="col-sm-6"><span class="help-block">多个请用<code>,</code>号隔开，如：jpg,png,exe，不限请留空</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">后台允许上传大小</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[admin_size]" value="<{$field.admin_size}>"/>
								</div>
								<div class="col-sm-6">
									<span class="help-block">单位<code>KB</code>，不限请填<code>0</code></span></div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">前台允许上传类型</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[home_type]" value="<{$field.home_type}>"/>
								</div>
								<div class="col-sm-6"><span class="help-block">多个请用<code>,</code>号隔开，如：jpg,png,exe，不限请留空</span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">前台允许上传大小</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[home_size]" value="<{$field.home_size}>"/>
								</div>
								<div class="col-sm-6">
									<span class="help-block">单位<code>KB</code>，不限请填<code>0</code></span></div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">上传密匙</label>

								<div class="col-sm-4">
									<div class="input-group">
										<input type="text" class="form-control" name="data[token]" id="token" value="<{$field.token}>"/>

										<div class="input-group-btn">
											<button class="btn btn-default" type="button" data-rand="32" role-target="#token">随机</button>
										</div>
									</div>
								</div>
								<div class="col-sm-6"><span class="help-block">16-32位随机字符串</span></div>
							</div>
						</div>
						<div role="tabpanel" class="tab-pane fade" id="watermark">
							<div class="form-group-title">水印设置</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">水印文件</label>

								<div class="col-sm-4">
									<input type="text" class="form-control" name="data[watermark_file]"  value="<{$field.watermark_file}>"/>
								</div>
								<div class="col-sm-6">
									<span class="help-block"><notempty name="field.watermark_file"><img id="water" src="__ROOT__/<{$field.watermark_file}>" height="30"></notempty></span>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">更改水印</label>

								<div class="col-sm-4">
									<input type="file" class="form-control" name="water"  multiple="multiple"/>
								</div>

							</div>
							<div class="form-group">
								<label class="col-sm-2 control-label">水印位置</label>

								<div class="col-sm-4">
									<select class="form-control" name="data[watermark_position]">
										<option value="1"
										<eq name="field.watermark_position" value="1">selected</eq>
										>左上角</option>
										<option value="2"
										<eq name="field.watermark_position" value="2">selected</eq>
										>上中上</option>
										<option value="3"
										<eq name="field.watermark_position" value="3">selected</eq>
										>右上角</option>
										<option value="4"
										<eq name="field.watermark_position" value="4">selected</eq>
										>左中左</option>
										<option value="5"
										<eq name="field.watermark_position" value="5">selected</eq>
										>中心</option>
										<option value="6"
										<eq name="field.watermark_position" value="6">selected</eq>
										>右中右</option>
										<option value="7"
										<eq name="field.watermark_position" value="7">selected</eq>
										>左下角</option>
										<option value="8"
										<eq name="field.watermark_position" value="8">selected</eq>
										>下中下</option>
										<option value="9"
										<eq name="field.watermark_position" value="9">selected</eq>
										>右下角</option>
									</select>
								</div>
								<div class="col-sm-6"></div>
							</div>
						</div>
						<div role="tabpanel" class="tab-pane fade" id="senior">
							<volist name="file_class" id="r">
								<input type="hidden" class="form-control" name="id[]" value="<{$r.id}>"/>
								<div class="file_class">
									<div class="form-group-title">
										<span class="label label-success pull-right"><{$r.enname}></span><{$r.name}>
										<div class="clearfix"></div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">允许上传类型</label>

										<div class="col-sm-4">
											<div class="input-group">
												<div class="input-group-addon"><{$type[$r['type']]}></div>
												<input type="text" class="form-control" name="class[<{$key}>][suffix]" value="<{$r.suffix}>"/>
											</div>
										</div>
										<div class="col-sm-6"><span class="help-block">多个请用<code>,</code>号隔开，如：jpg,exe，不限请留空，-1代表调用系统基本配置</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">mimeType</label>

										<div class="col-sm-4">
											<div class="input-group">
												<div class="input-group-addon"><{$type[$r['type']]}></div>
												<input type="text" class="form-control" name="class[<{$key}>][mimetype]" value="<{$r.mimetype}>"/>
											</div>
										</div>
										<div class="col-sm-6"><span class="help-block">多个请用<code>,</code>号隔开，如：image/jpg,image/gif，不限请留空</span>
										</div>
									</div>
									<div class="form-group">
										<label class="col-sm-2 control-label">允许上传大小</label>

										<div class="col-sm-4">
											<div class="input-group">
												<input type="text" class="form-control" name="class[<{$key}>][size]" id="" value="<{$r.size}>"/>

												<div class="input-group-addon">KB</div>
											</div>
										</div>
										<div class="col-sm-6"><span class="help-block">0 为不限制，-1 则调用系统基本配置</span></div>
									</div>
									<eq name="r.type" value="image">
										<div class="form-group">
											<label class="col-sm-2 control-label">缩放设置</label>

											<div class="col-sm-4">
												<label class="checkbox-inline"><input type="checkbox" class="is_thumb" name="class[<{$key}>][is_thumb]" value="1"
													<eq name="r.is_thumb" value="1">checked</eq>
													/>缩放图片</label>
												<label class="checkbox-inline"><input type="checkbox" name="class[<{$key}>][delete_source]" value="1"
													<eq name="r.delete_source" value="1">checked</eq>
													/>不保留原图</label>
												<label class="checkbox-inline"><input type="checkbox" name="class[<{$key}>][watermark]" value="1"
													<eq name="r.watermark" value="1">checked</eq>
													/>加水印</label>
											</div>
											<div class="col-sm-6"></div>
										</div>
										<div class="form-group">
											<label class="col-sm-2 control-label">缩放方式</label>
											<div class="col-sm-4">
												<select class="form-control" name="class[<{$key}>][thumb_type]">
													<option value="1"
													<eq name="r.thumb_type" value="1">selected</eq>
													>等比例缩放</option>
													<option value="2"
													<eq name="r.thumb_type" value="2">selected</eq>
													>缩放后填充</option>
													<option value="3"
													<eq name="r.thumb_type" value="3">selected</eq>
													>居中裁剪</option>
													<option value="6"
													<eq name="r.thumb_type" value="6">selected</eq>
													>固定尺寸缩放</option>
												</select>
											</div>
											<div class="col-sm-6"></div>
										</div>
										<if condition='$r.is_thumb eq 1' >
											<div class="form-group"  id="sizebox"style="display:block" >
										<else/>
											<div class="form-group"  id="sizebox" >
										</if>
											<label class="col-sm-2 control-label">图片大小及数量</label>
											<div class="col-sm-4">
												<textarea class="form-control" name="class[<{$key}>][pics_size]" rows="4"><{$r.pics_size}></textarea>
											</div>
											<div class="col-sm-4">
												<span class="help-block">一行一条，格式：<code>字段名==宽*高</code>，<br/>有多少行则代表生成多少种缩图</span>
											</div>
										</div>
									</eq>
								</div>
							</volist>
						</div>
					</div>
				<div class="form-group m-b-0">
					<div class="col-sm-offset-2 col-sm-10">
						<input type="submit" class="btn btn-primary" value="设置"/>
						<input type="reset" class="btn btn-default" value="重置"/>
					</div>
				</div>
			</form>
			</div>
		</div>
	</div>
</block>
<block name="foot">
	<script type="text/javascript">
		/**
		 * 自动随机字符串组件
		 */
		$.getRandString = function (line, callback) {
			$.post("<{:U('get_rand_string')}>", {'line' : line}, function (data) {
				callback(data);
			});
		};
		$(document).on('click.data_rand', "[data-rand]", function () {
			var $this   = $(this),
				$target = $($this.attr('role-target')),
				line    = $this.data('length') || $this.data('rand'),
				tip     = $this.data('tip') || '请稍后',
				defTip  = $this.val() || $this.text(),
				tagName = $this[0].tagName;
			if ($this.prop('disabled')) {
				return false;
			}
			$this.prop('disabled', true);
			if (tagName === 'INPUT') {
				$this.val(tip);
			} else {
				$this.html(tip);
			}
			$.getRandString(line, function (data) {
				$this.prop('disabled', false);
				if (tagName === 'INPUT') {
					$this.val(defTip);
				} else {
					$this.html(defTip);
				}
				$target.val(data);
			});
		});
		$("input[type=checkbox].is_thumb").click(function () {
			if ($(this).prop("checked")) {
				$(this).parents(".form-group").siblings("#sizebox").show()
			} else {
				$(this).parents(".form-group").siblings("#sizebox").hide()
			}
		});
	</script>
</block>